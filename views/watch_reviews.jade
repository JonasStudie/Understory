extends layout

block content
  if review
    h1= review.evnt_name
    h3= review.company_name
    p= review.short_review
  else
    h1 Begivenhed ikke fundet
    p Der blev ikke fundet nogen data for denne begivenhed.
    a(href='/review') Tilbage til oversigten
    return

  hr
  h2 Anmeldelser
  hr

  if eventReviews && eventReviews.length
    each r in eventReviews
      .review-box
        h4= r.first_name
        p
          | Oplevet:
          = ' ' + r.experience_date
        p
          | Stjerner:
          = ' ' + r.rating + '/5⭐'
        p= r.comment
        hr
  else
    p Der er ingen anmeldelser for denne begivenhed endnu.

  //- knap der åbner popup
  .actions
    a.button(href='/review') Tilbage til oversigten
    a.button(href='#', id='open-review-popup') Skriv en anmeldelse 
    

  //- Popup form
  #review-popup.popup.hidden
    .popup-content
      span.popup-close &times;
      h2 Skriv en anmeldelse

      form(action='/review/' + review.id method='POST')
        if firstName
          input(type='hidden' name='first_name' value=firstName)
        else if user && user.firstName
          input(type='hidden' name='first_name' value=user.firstName)
        else if session && session.firstName
          input(type='hidden' name='first_name' value=session.firstName)
        else
          div
            label(for='first_name') Fornavn:
            input(type='text' name='first_name' id='first_name' required)
        div
          label(for='experience_date') Dato for oplevelse:
          input(type='date' name='experience_date' id='experience_date' required)
        div
          label(for='rating') Antal stjerner (1–5):
          select(name='rating' id='rating' required)
            option(value='') Vælg
            option(value='1') 1
            option(value='2') 2
            option(value='3') 3
            option(value='4') 4
            option(value='5') 5
        div
          label(for='comment') Kommentar:
          textarea(name='comment' id='comment' rows='4' required)
        button(type='submit') Gem anmeldelse

  //- JS til at åbne/lukke popup
  script.
    document.addEventListener('DOMContentLoaded', function() {
      const openBtn = document.getElementById('open-review-popup');
      const popup = document.getElementById('review-popup');
      const closeBtn = document.querySelector('#review-popup .popup-close');

      if (openBtn && popup && closeBtn) {
        openBtn.addEventListener('click', function(e) {
          e.preventDefault(); // vigtigt når det er et <a>
          popup.classList.remove('hidden');
        });

        closeBtn.addEventListener('click', function() {
          popup.classList.add('hidden');
        });

        popup.addEventListener('click', function(e) {
          if (e.target === popup) {
            popup.classList.add('hidden');
          }
        });
      }
    });
